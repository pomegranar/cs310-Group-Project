<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Sports Complex IMS</title>
		<!-- Bootstrap CSS -->
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />

		<style>
			.logo-left {
				max-height: 60px; /* Size for the left logo */
			}

			.logo-right {
				max-height: 95px; /* Size for the right logo */
			}
		</style>
	</head>
	<body>
		<!-- Navbar -->
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
			<div class="container-fluid">
				<a class="navbar-brand" href="/">Sports Complex IMS</a>
				<button
					class="navbar-toggler"
					type="button"
					data-bs-toggle="collapse"
					data-bs-target="#navbarNav"
					aria-controls="navbarNav"
					aria-expanded="false"
					aria-label="Toggle navigation"
				>
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarNav">
					<ul class="navbar-nav">
						<li class="nav-item">
							<a class="nav-link active" aria-current="page" href="/">Equipment Check-Out</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="/reserve">Facility Reservations</a>
						</li>
					</ul>
				</div>
			</div>
		</nav>

		<!-- Logo Section -->
		<div class="container-fluid py-3 bg-light">
			<div class="d-flex justify-content-between align-items-center">
				<!-- Left Logo -->
				<img src="/static/DKU_logo.png" alt="Left Logo" class="logo-left" />
				<!-- Right Logo -->
				<img src="/static/Athletics_logo.png" alt="Right Logo" class="logo-right" />
			</div>
		</div>

		<!-- Main Content -->
		<div class="container mt-5">
			<h1 class="text-center mb-4">Equipment Check-Out</h1>
			<div class="row justify-content-center">
				<div class="col-md-6">
					<!-- Equipment Check-Out Form -->
					<form id="checkOutForm" class="p-4 border rounded shadow">
						<div id="qr-scanner">
							<video id="qr-video" style="width: 100%"></video>
							<button id="start-scan">Start Scanning</button>
						</div>
						<script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
						<script>
							const video = document.getElementById("qr-video");
							const startScanButton = document.getElementById("start-scan");

							startScanButton.addEventListener("click", () => {
								const html5QrCode = new Html5Qrcode("qr-video");
								html5QrCode
									.start(
										{ facingMode: "environment" }, // Rear camera
										{
											fps: 10, // Scans per second
											qrbox: 250, // Box size for the QR code scanner
										},
										(qrCodeMessage) => {
											console.log("Scanned QR code:", qrCodeMessage);

											// Send equipment ID (scanned QR code) to the backend
											fetch("/checkout_equipment", {
												method: "POST",
												headers: {
													"Content-Type": "application/json",
												},
												body: JSON.stringify({
													card_number: "112233", // Replace with actual card number
													equipment_id: qrCodeMessage,
												}),
											})
												.then((response) => response.json())
												.then((data) => alert(data.message))
												.catch((err) => console.error(err));

											html5QrCode.stop();
										},
										(errorMessage) => {
											console.warn("QR code scanning failed:", errorMessage);
										}
									)
									.catch((err) => console.error(err));
							});
						</script>
						<div id="reader" style="width: 300px"></div>
						<div class="mb-3">
							<label for="card_id" class="form-label">Tap Card:</label>
							<input type="text" id="card_id" name="card_id" class="form-control" placeholder="Enter your card ID" required />
						</div>
						<div class="mb-3">
							<label for="equipment" class="form-label">Select Equipment:</label>
							<select id="equipment" name="equipment" class="form-select" required>
								<!-- Options will be populated dynamically -->
							</select>
						</div>
						<button type="submit" class="btn btn-primary w-100">Check Out</button>

						<script src="https://cdn.jsdelivr.net/npm/html5-qrcode/minified/html5-qrcode.min.js"></script>
						<script>
							const html5QrCode = new Html5Qrcode("reader");
							html5QrCode.start({ facingMode: "environment" }, { fps: 10 }, (decodedText) => {
								// Send decoded text to Flask
								fetch("/scan", {
									method: "POST",
									headers: { "Content-Type": "application/json" },
									body: JSON.stringify({ code: decodedText }),
								})
									.then((response) => response.json())
									.then((data) => console.log(data));
							});
						</script>
					</form>
				</div>
			</div>
		</div>

		<!-- Result Alert -->
		<div class="container mt-3">
			<div id="result" class="alert alert-info d-none" role="alert"></div>
		</div>

		<!-- Footer -->
		<footer class="bg-dark text-white text-center py-3 mt-5">
			<p>&copy; 2024 DKU Sports Complex. All Rights Reserved.</p>
		</footer>

		<!-- Bootstrap JS -->
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

		<!-- Main JS stuff. -->
		<script src="../static/main.js"></script>
	</body>
</html>
