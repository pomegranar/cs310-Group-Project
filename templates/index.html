<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Sports Complex IMS</title>
   <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
   <h1>Sports Complex Inventory Management System</h1>

   <form id="checkOutForm">
      <label for="card_id">Tap card:</label>
      <input type="text" id="card_id" name="card_id" autofocus required>

      <label for="equipment">Select Equipment:</label>
      <select id="equipment" name="equipment" required>
         <!-- Options will be populated dynamically -->
      </select>

      <button type="submit">Check Out</button>
   </form>

   <script>
      document.addEventListener('DOMContentLoaded', function() {
         const equipmentSelect = document.getElementById('equipment');

         // Fetch equipment data from the server and populate options dynamically.
         fetch('/get_equipment')
            .then(response => response.json())
            .then(data => {
               data.forEach(e => { // Corrected variable usage.
                  const option = document.createElement('option');
                  option.value = e.equipment_id; // Assuming the server returns `equipment_id`.
                  option.textContent = `${e.sport} - ${e.name} #${e.number}`;
                  equipmentSelect.appendChild(option);
               });
            })
            .catch(error => console.error('Error fetching equipment data:', error)); // Added error handling.

         document.getElementById('checkOutForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const card_number = document.getElementById('card_id').value; // Corrected ID to match `card_id`.
            const equipment_id = document.getElementById('equipment').value;

            fetch('/checkout_equipment', {
               method: 'POST',
               headers: { 'Content-Type': 'application/json' },
               body: JSON.stringify({ card_number: card_number, equipment_id: equipment_id })
            })
            .then(response => response.json())
            .then(data => {
               if (data.success) {
                  alert(data.message);
               } else {
                  alert(`Error: ${data.message}`);
               }
            })
            .catch(error => console.error('Error submitting form:', error)); // Added error handling.
         });
      });
   </script>
</body>
</html>
