<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Facility Reservation</title>
		<!-- Bootstrap CSS -->
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />

		<style>
			.logo-left {
				max-height: 60px; /* Size for the left logo */
			}

			.logo-right {
				max-height: 95px; /* Size for the right logo */
			}
		</style>
	</head>
	<body>
		<!-- Navbar -->
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
			<div class="container-fluid">
				<a class="navbar-brand" href="/">Sports Complex IMS</a>
				<button
					class="navbar-toggler"
					type="button"
					data-bs-toggle="collapse"
					data-bs-target="#navbarNav"
					aria-controls="navbarNav"
					aria-expanded="false"
					aria-label="Toggle navigation"
				>
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarNav">
					<ul class="navbar-nav">
						<li class="nav-item">
							<a class="nav-link" href="/">Equipment Check-Out</a>
						</li>
						<li class="nav-item">
							<a class="nav-link active" href="/reserve">Facility Reservations</a>
						</li>
					</ul>
				</div>
			</div>
		</nav>

		<!-- Logo Section -->
		<div class="container-fluid py-3 bg-light">
			<div class="d-flex justify-content-between align-items-center">
				<!-- Left Logo -->
				<img src="/static/DKU_logo.png" alt="DKU Logo" class="logo-left" />
				<!-- Right Logo -->
				<img src="/static/Athletics_logo.png" alt="Athletics Logo" class="logo-right" />
			</div>
		</div>

		<!-- Main Content -->
		<div class="container mt-5">
			<h1 class="text-center mb-4">Reserve a Facility</h1>
			<div class="row justify-content-center">
				<div class="col-md-6">
					<!-- Facility Reservation Form -->
					<form id="reservationForm" class="p-4 border rounded shadow">
						<div class="mb-3">
							<label for="cardNumber" class="form-label">Card Number:</label>
							<input type="text" id="cardNumber" class="form-control" placeholder="Enter your card number" required />
						</div>
						<div class="mb-3">
							<label for="facilityId" class="form-label">Facility:</label>
							<select id="facilityId" name="facility" title="facility" class="form-select" required>
								<!-- Options will be populated dynamically -->
							</select>
						</div>
						<div class="mb-3">
							<label for="reserveDate" class="form-label">Date:</label>
							<input type="date" id="reserveDate" class="form-control" required />
						</div>
						<div class="mb-3">
							<label for="startTime" class="form-label">Start Time:</label>
							<input type="time" id="startTime" class="form-control" required />
						</div>
						<div class="mb-3">
							<label for="endTime" class="form-label">End Time:</label>
							<input type="time" id="endTime" class="form-control" required />
						</div>
						<button type="submit" class="btn btn-primary w-100">Reserve</button>
					</form>
				</div>
			</div>
		</div>

		<!-- Result Alert -->
		<div class="container mt-3">
			<div id="result" class="alert alert-info d-none" role="alert"></div>
		</div>

		<!-- Footer -->
		<footer class="bg-dark text-white text-center py-3 mt-5">
			<p>&copy; 2024 DKU Sports Complex. All Rights Reserved.</p>
		</footer>

		<!-- Bootstrap JS -->
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

		<!-- JavaScript for Form -->
		<script>
			document.getElementById("reservationForm").addEventListener("submit", async (e) => {
				e.preventDefault();

				const response = await fetch("/reserve_facility", {
					method: "POST",
					headers: { "Content-Type": "application/json" },
					body: JSON.stringify({
						card_number: document.getElementById("cardNumber").value,
						facility_id: document.getElementById("facilityId").value,
						reserve_date: document.getElementById("reserveDate").value,
						start_time: document.getElementById("startTime").value,
						end_time: document.getElementById("endTime").value,
					}),
				});

				const result = await response.json();
				const resultAlert = document.getElementById("result");
				resultAlert.classList.remove("d-none");
				resultAlert.classList.add(result.status === "success" ? "alert-success" : "alert-danger");
				resultAlert.textContent = result.message;
			});

			document.addEventListener("DOMContentLoaded", function () {
				const facilitySelect = document.getElementById("facilityId");

				// Fetch facility data from the server and populate options dynamically.
				fetch("/get_facility")
					.then((response) => response.json())
					.then((data) => {
						data.forEach((facility) => {
							const option = document.createElement("option");
							option.value = facility.facility_id;
							option.textContent = `Floor ${facility.floor}: ${facility.name} (Available: ${facility.reservable ? "Yes" : "No"})`;
							facilitySelect.appendChild(option);
						});
					})
					.catch((error) => console.error("Error fetching facility data:", error));
			});
		</script>
	</body>
</html>
